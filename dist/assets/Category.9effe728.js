var E=Object.defineProperty,A=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var V=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,B=Object.prototype.propertyIsEnumerable;var N=(e,a,r)=>a in e?E(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r,I=(e,a)=>{for(var r in a||(a={}))q.call(a,r)&&N(e,r,a[r]);if(V)for(var r of V(a))B.call(a,r)&&N(e,r,a[r]);return e},S=(e,a)=>A(e,j(a));import{ag as w,ak as L,r as R,t as $,d as u,e as D,n as z,w as s,g as h,j as l,E as _,b as y,k as b,u as T,o as U,m as G,ai as M,f as O,F as x,aj as H,p as J,l as K}from"./vendor.02cb7ec1.js";import{_ as P,h as Q}from"./index.2e8264d3.js";const W={name:"DialogAddCategory",props:{type:String,reload:Function},setup(e){const a=w(null),r=L(),t=R({visible:!1,categoryLevel:1,parentId:0,ruleForm:{name:"",rank:""},rules:{name:[{required:"true",message:"\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:["change"]}],rank:[{required:"true",message:"\u6392\u5E8F\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:["change"]}]},id:""}),n=i=>{y.get(`/categories/${i}`).then(c=>{t.ruleForm={name:c.categoryName,rank:c.categoryRank},t.parentId=c.parentId,t.categoryLevel=c.categoryLevel})},v=i=>{if(t.visible=!0,i)t.id=i,n(i);else{const{level:c=1,parent_id:f=0}=r.query;t.ruleForm={name:"",rank:""},t.parentId=f,t.categoryLevel=c}},d=()=>{t.visible=!1},p=()=>{a.value.validate(i=>{if(i){if(Q(t.ruleForm.name)){_.error("\u4E0D\u8981\u8F93\u5165\u8868\u60C5\u5305\uFF0C\u518D\u8F93\u5165\u5C31\u6253\u6B7B\u4F60\u4E2A\u9F9F\u5B59\u513F~");return}if(t.ruleForm.name.length>16){_.error("\u540D\u79F0\u4E0D\u80FD\u8D85\u8FC716\u4E2A\u5B57\u7B26");return}if(t.ruleForm.rank>200){_.error("\u6392\u5E8F\u4E0D\u80FD\u8D85\u8FC7200");return}e.type=="add"?y.post("/categories",{categoryLevel:t.categoryLevel,parentId:t.parentId,categoryName:t.ruleForm.name,categoryRank:t.ruleForm.rank}).then(()=>{_.success("\u6DFB\u52A0\u6210\u529F"),t.visible=!1,e.reload&&e.reload()}):y.put("/categories",{categoryId:t.id,categoryLevel:t.categoryLevel,parentId:t.parentId,categoryName:t.ruleForm.name,categoryRank:t.ruleForm.rank}).then(()=>{_.success("\u4FEE\u6539\u6210\u529F"),t.visible=!1,e.reload&&e.reload()})}})};return S(I({},$(t)),{open:v,close:d,formRef:a,submitForm:p})}},X={class:"dialog-footer"},Y=b("\u53D6 \u6D88"),Z=b("\u786E \u5B9A");function ee(e,a,r,t,n,v){const d=u("el-input"),p=u("el-form-item"),i=u("el-form"),c=u("el-button"),f=u("el-dialog");return D(),z(f,{title:r.type=="add"?"\u6DFB\u52A0\u5206\u7C7B":"\u4FEE\u6539\u5206\u7C7B",modelValue:e.visible,"onUpdate:modelValue":a[3]||(a[3]=m=>e.visible=m),width:"400px"},{footer:s(()=>[h("span",X,[l(c,{onClick:a[2]||(a[2]=m=>e.visible=!1)},{default:s(()=>[Y]),_:1}),l(c,{type:"primary",onClick:t.submitForm},{default:s(()=>[Z]),_:1},8,["onClick"])])]),default:s(()=>[l(i,{model:e.ruleForm,rules:e.rules,ref:"formRef","label-width":"100px",class:"good-form"},{default:s(()=>[l(p,{label:"\u5206\u7C7B\u540D\u79F0",prop:"name"},{default:s(()=>[l(d,{type:"text",modelValue:e.ruleForm.name,"onUpdate:modelValue":a[0]||(a[0]=m=>e.ruleForm.name=m)},null,8,["modelValue"])]),_:1}),l(p,{label:"\u6392\u5E8F\u503C",prop:"rank"},{default:s(()=>[l(d,{type:"number",max:"200",modelValue:e.ruleForm.rank,"onUpdate:modelValue":a[1]||(a[1]=m=>e.ruleForm.rank=m)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])}var te=P(W,[["render",ee]]);const ae={name:"Category",components:{DialogAddCategory:te},setup(){const e=w(null),a=w(null),r=T(),t=L(),n=R({loading:!1,tableData:[],multipleSelection:[],total:0,currentPage:1,pageSize:10,type:"add",level:1,parent_id:0});U(()=>{d()}),G(()=>{v()});const v=r.afterEach(o=>{["category","level2","level3"].includes(o.name)&&d()}),d=()=>{const{level:o=1,parent_id:g=0}=t.query;n.loading=!0,y.get("/categories",{params:{pageNumber:n.currentPage,pageSize:n.pageSize,categoryLevel:o,parentId:g}}).then(F=>{n.tableData=F.list,n.total=F.totalCount,n.currentPage=F.currPage,n.loading=!1,n.level=o,n.parentId=g})},p=()=>{n.type="add",a.value.open()},i=o=>{n.type="edit",a.value.open(o)},c=o=>{n.multipleSelection=o},f=()=>{if(!n.multipleSelection.length){_.error("\u8BF7\u9009\u62E9\u9879");return}y.delete("/categories",{data:{ids:n.multipleSelection.map(o=>o.categoryId)}}).then(()=>{_.success("\u5220\u9664\u6210\u529F"),d()})},m=o=>{y.delete("/categories",{data:{ids:[o]}}).then(()=>{_.success("\u5220\u9664\u6210\u529F"),d()})},C=o=>{n.currentPage=o,d()},k=o=>{const g=o.categoryLevel+1;if(g==4){_.error("\u6CA1\u6709\u4E0B\u4E00\u7EA7");return}r.push({name:`level${g}`,query:{level:g,parent_id:o.categoryId}})};return S(I({},$(n)),{multipleTable:e,handleSelectionChange:c,addGood:a,handleAdd:p,handleEdit:i,handleDelete:f,handleDeleteOne:m,getCategory:d,changePage:C,handleNext:k})}},oe=e=>(J("data-v-2206bec4"),e=e(),K(),e),ne={class:"header"},le=b("\u589E\u52A0"),re=b("\u6279\u91CF\u5220\u9664"),ie=["onClick"],se=["onClick"],de=oe(()=>h("a",{style:{cursor:"pointer"}},"\u5220\u9664",-1));function ce(e,a,r,t,n,v){const d=u("el-button"),p=u("el-popconfirm"),i=u("el-table-column"),c=u("el-table"),f=u("el-pagination"),m=u("el-card"),C=u("DialogAddCategory"),k=M("loading");return D(),O(x,null,[l(m,{class:"category-container"},{header:s(()=>[h("div",ne,[l(d,{type:"primary",size:"small",icon:"el-icon-plus",onClick:t.handleAdd},{default:s(()=>[le]),_:1},8,["onClick"]),l(p,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:t.handleDelete},{reference:s(()=>[l(d,{type:"danger",size:"small",icon:"el-icon-delete"},{default:s(()=>[re]),_:1})]),_:1},8,["onConfirm"])])]),default:s(()=>[H((D(),z(c,{ref:"multipleTable",data:e.tableData,"tooltip-effect":"dark",style:{width:"100%"},onSelectionChange:t.handleSelectionChange},{default:s(()=>[l(i,{type:"selection",width:"55"}),l(i,{prop:"categoryName",label:"\u5206\u7C7B\u540D\u79F0"}),l(i,{prop:"categoryRank",label:"\u6392\u5E8F\u503C",width:"120"}),l(i,{prop:"createTime",label:"\u6DFB\u52A0\u65F6\u95F4",width:"200"}),l(i,{label:"\u64CD\u4F5C",width:"220"},{default:s(o=>[h("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:g=>t.handleEdit(o.row.categoryId)},"\u4FEE\u6539",8,ie),h("a",{style:{cursor:"pointer","margin-right":"10px"},onClick:g=>t.handleNext(o.row)},"\u4E0B\u7EA7\u5206\u7C7B",8,se),l(p,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:g=>t.handleDeleteOne(o.row.categoryId)},{reference:s(()=>[de]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[k,e.loading]]),l(f,{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pageSize,"current-page":e.currentPage,onCurrentChange:t.changePage},null,8,["total","page-size","current-page","onCurrentChange"])]),_:1}),l(C,{ref:"addGood",reload:t.getCategory,type:e.type,level:e.level,parent_id:e.parent_id},null,8,["reload","type","level","parent_id"])],64)}var ge=P(ae,[["render",ce],["__scopeId","data-v-2206bec4"]]);export{ge as default};
