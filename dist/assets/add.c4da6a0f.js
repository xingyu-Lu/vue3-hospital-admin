var q=Object.defineProperty,z=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var L=(o,l,n)=>l in o?q(o,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[l]=n,R=(o,l)=>{for(var n in l||(l={}))C.call(l,n)&&L(o,n,l[n]);if(y)for(var n of y(l))H.call(l,n)&&L(o,n,l[n]);return o},w=(o,l)=>z(o,B(l));import{an as x,as as E,am as f,aq as M,u as N,r as P,o as $,b as V,au as D,t as O,d as m,e as W,n as G,w as i,E as p,j as s,g as T,k as _,i as J}from"./vendor.01b972a0.js";import{W as K}from"./wangEditor.c26ea0ba.js";import{_ as Q,a as X,c as U,u as Y}from"./index.ad7a0fba.js";const Z={name:"news_add",components:{Plus:x,Delete:E},setup(){const o=f(null),l=f(null),n=f(null),u=f(null),I=M(),A=N(),{id:d}=I.query,t=P({token:"Bearer "+X("token")||"",id:d,Form:{attachment:"",img_url:"",img:"",office_id:"",title:"",content:"",release_time:f(""),status:"0",disabled:!0,fileList:[],attachmentFileList:[],list:[]},rules:{img:[{required:!0,message:"\u56FE\u7247\u5FC5\u987B",trigger:["change"]}],title:[{required:!1,message:"\u6807\u9898",trigger:["change"]}],release_time:[{required:"true",message:"\u53D1\u5E03\u65F6\u95F4\u5FC5\u987B",trigger:["change"]}],status:[{required:!1,message:"\u72B6\u6001\u5FC5\u987B",trigger:["change"]}]}});let e;$(()=>{e=new K(n.value),e.config.lineHeights=["1","1.15","1.5","2","2.5","3"],e.config.showLinkImg=!1,e.config.showLinkImgAlt=!1,e.config.showLinkImgHref=!1,e.config.uploadImgMaxSize=2*1024*1024,e.config.uploadImgMaxLength=1,e.config.uploadImgAccept=["jpg","jpeg","png","gif","bmp","webp"],e.config.uploadFileName="file",e.config.uploadImgHeaders={Authorization:t.token},e.config.uploadImgParams={basket:"img"},e.config.uploadImgHooks={customInsert:function(a,r){console.log("result",r),a(r.data.src)}},e.config.uploadImgServer=U,Object.assign(e.config,{onchange(){console.log("change")}}),e.config.uploadVideoServer=U,e.config.uploadVideoMaxSize=1*200*1024*1024,e.config.uploadVideoAccept=["mp4"],e.config.uploadVideoParams={basket:"video"},e.config.uploadVideoName="file",e.config.uploadVideoHeaders={Authorization:t.token},e.config.uploadVideoHooks={customInsert:function(a,r){console.log("customInsert",r),a(r.data.src)}},e.create(),d&&V.get(`/api/back/epidemicControls/${d}`).then(a=>{t.Form={attachment:a.data.attachment_id,attachmentFileList:a.data.attachment,title:a.data.title,release_time:a.data.release_time,status:String(a.data.status)},e&&e.txt.html(a.data.content)})}),D(()=>{e.destroy(),e=null});const h=()=>{l.value.validate(a=>{if(a){let r=V.post,S={attachment:t.Form.attachment,title:t.Form.title,content:e.txt.html(),release_time:t.Form.release_time,status:t.Form.status},j="/api/back/epidemicControls";d&&(S.release_time=t.Form.release_time,r=V.put,j=`/api/back/epidemicControls/${d}`),r(j,S).then(()=>{d?p.success("\u4FEE\u6539\u6210\u529F"):p.success("\u6DFB\u52A0\u6210\u529F"),A.push({path:"/epidemic-control"})})}})},F=a=>{const r=a.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(r))return p.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png \u683C\u5F0F\u7684\u56FE\u7247"),!1},g=a=>{p.success("\u4E0A\u4F20\u6210\u529F"),t.Form.img_url=a.data.src||"",t.Form.img=a.data.id||""},b=a=>{p.error("\u4E0A\u4F20\u5931\u8D25")},k=a=>{u.value.clearFiles(),t.Form.img="",t.Form.img_url="",t.Form.fileList=[]},v=a=>{p.success("\u4E0A\u4F20\u6210\u529F"),t.Form.attachmentFileList.push({name:a.data.src,url:a.data.src}),t.Form.attachment?t.Form.attachment=t.Form.attachment+","+a.data.id:t.Form.attachment=a.data.id},c=a=>{o.value.clearFiles(),t.Form.attachment="",t.Form.attachmentFileList=[]};return w(R({},O(t)),{editor:n,uploadRef:u,attachmentRef:o,Ref:l,submitAdd:h,uploadImgServer:Y,handleBeforeUpload:F,handleUrlSuccess:g,handleUrlError:b,handleRemove:k,handleAttachmentSuccess:v,handleAttachmentRemove:c})}},ee=_("\u4E0A\u4F20"),te={ref:"editor",style:{"z-index":"1"}},ae=_("\u5DF2\u5BA1\u6838"),oe=_("\u5F85\u5BA1\u6838");function le(o,l,n,u,I,A){const d=m("el-input"),t=m("el-form-item"),e=m("el-button"),h=m("el-upload"),F=m("el-date-picker"),g=m("el-radio"),b=m("el-radio-group"),k=m("el-form"),v=m("el-card");return W(),G(v,{style:{"min-height":"100%"}},{default:i(()=>[s(k,{model:o.Form,rules:o.rules,ref:"Ref","label-width":"100px"},{default:i(()=>[s(t,{label:"\u6807\u9898",prop:"title"},{default:i(()=>[s(d,{modelValue:o.Form.title,"onUpdate:modelValue":l[0]||(l[0]=c=>o.Form.title=c),placeholder:"\u8BF7\u8F93\u5165\u6807\u9898",type:"text"},null,8,["modelValue"])]),_:1}),s(t,{label:"\u9644\u4EF6",prop:"attachment"},{default:i(()=>[s(h,{ref:"attachmentRef",headers:{Authorization:o.token},action:u.uploadImgServer,"on-remove":u.handleAttachmentRemove,"on-success":u.handleAttachmentSuccess,"auto-upload":!0,data:{basket:"attachment"},limit:3,multiple:"","file-list":o.Form.attachmentFileList},{default:i(()=>[s(e,{type:"primary"},{default:i(()=>[ee]),_:1})]),_:1},8,["headers","action","on-remove","on-success","file-list"])]),_:1}),s(t,{label:"\u5185\u5BB9",prop:"content"},{default:i(()=>[T("div",te,null,512)]),_:1}),s(t,{label:"\u53D1\u5E03\u65F6\u95F4",prop:"release_time"},{default:i(()=>[s(F,{modelValue:o.Form.release_time,"onUpdate:modelValue":l[1]||(l[1]=c=>o.Form.release_time=c),type:"datetime",placeholder:"\u8BF7\u8F93\u5165\u53D1\u5E03\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),s(t,{label:"\u72B6\u6001",prop:"status"},{default:i(()=>[s(b,{modelValue:o.Form.status,"onUpdate:modelValue":l[2]||(l[2]=c=>o.Form.status=c),disabled:""},{default:i(()=>[s(g,{label:"1"},{default:i(()=>[ae]),_:1}),s(g,{label:"0"},{default:i(()=>[oe]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(t,null,{default:i(()=>[s(e,{type:"primary",onClick:l[3]||(l[3]=c=>u.submitAdd())},{default:i(()=>[_(J(o.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})}var me=Q(Z,[["render",le]]);export{me as default};
