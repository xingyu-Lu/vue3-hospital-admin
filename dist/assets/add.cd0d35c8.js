var B=Object.defineProperty,z=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var T=(a,t,n)=>t in a?B(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n,x=(a,t)=>{for(var n in t||(t={}))I.call(t,n)&&T(a,n,t[n]);if(A)for(var n of A(t))L.call(t,n)&&T(a,n,t[n]);return a},S=(a,t)=>z(a,q(t));import{an as M,as as O,am as h,aq as $,u as H,r as K,au as D,E as f,o as G,b as V,av as P,t as J,d as c,e as Q,n as W,w as i,j as r,g as X,k as w,i as Y}from"./vendor.3551a4ac.js";import{a as U,B as Z,E as ee,T as te}from"./index.esm.f6ae3e45.js";import{_ as ae,a as oe,c as E,u as le}from"./index.a688a88b.js";function ne(a,t){const{link:n="",fileName:s=""}=a;return`<a data-w-e-type="attachment" data-w-e-is-void data-w-e-is-inline data-link="${n}" data-fileName="${s}" href="${n}" target="_blank">${s}</a>`}const re={type:"attachment",elemToHtml:ne};U.elemsToHtml=[re];Z.registerModule(U);const se={name:"news_add",components:{Plus:M,Delete:O,Editor:ee,Toolbar:te},setup(){const a=h(null),t=h(null),n=h(null),s=$(),R=H(),{id:p}=s.query,o=K({token:"Bearer "+oe("token")||"",id:p,Form:{attachment:"",img_url:"",img:"",office_id:"",title:"",content:"",release_time:h(""),status:"0",disabled:!0,fileList:[],attachmentFileList:[],list:[]},rules:{img:[{required:!0,message:"\u56FE\u7247\u5FC5\u987B",trigger:["change"]}],title:[{required:!1,message:"\u6807\u9898",trigger:["change"]}],release_time:[{required:"true",message:"\u53D1\u5E03\u65F6\u95F4\u5FC5\u987B",trigger:["change"]}],status:[{required:!1,message:"\u72B6\u6001\u5FC5\u987B",trigger:["change"]}]}}),u=D(),_={insertKeys:{index:31,keys:["uploadAttachment"]}},F={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",hoverbarKeys:{attachment:{menuKeys:["downloadAttachment"]}},MENU_CONF:{uploadImage:{server:E,fieldName:"file",maxFileSize:2*1024*1024,maxNumberOfFiles:10,allowedFileTypes:["image/*"],meta:{basket:"img"},headers:{Authorization:o.token},customInsert:function(e,l){l(e.data.src,e.data.file_name,e.data.src)},onError(e,l,m){f.error(new Error(l).message),console.log(e,l,m)}},uploadVideo:{server:E,fieldName:"file",maxFileSize:100*1024*1024,allowedFileTypes:["video/*"],meta:{basket:"video"},headers:{Authorization:o.token},customInsert:function(e,l){l(e.data.src)},onError(e,l,m){f.error(new Error(l).message),console.log(e,l,m)}},uploadAttachment:{server:E,fieldName:"file",maxFileSize:10*1024*1024,meta:{basket:"attachment"},headers:{Authorization:o.token},customInsert:function(e,l,m){m(`${l.name}`,e.data.src)},onError(e,l,m){f.error(new Error(l).message),console.log(e,l,m)}}}},b=e=>{u.value=e};G(()=>{p&&V.get(`/api/back/epidemicControls/${p}`).then(e=>{o.Form={attachment:e.data.attachment_id,attachmentFileList:e.data.attachment,title:e.data.title,content:e.data.content,release_time:e.data.release_time,status:String(e.data.status)}})}),P(()=>{const e=u.value;e!=null&&e.destroy()});const g=()=>{t.value.validate(e=>{if(e){let l=V.post,m={attachment:o.Form.attachment,title:o.Form.title,content:o.Form.content,release_time:o.Form.release_time,status:o.Form.status},N="/api/back/epidemicControls";p&&(m.release_time=o.Form.release_time,l=V.put,N=`/api/back/epidemicControls/${p}`),l(N,m).then(()=>{p?f.success("\u4FEE\u6539\u6210\u529F"):f.success("\u6DFB\u52A0\u6210\u529F"),R.push({path:"/epidemic-control"})})}})},v=e=>{const l=e.name.split(".")[1]||"";if(!["jpg","jpeg","png"].includes(l))return f.error("\u8BF7\u4E0A\u4F20 jpg\u3001jpeg\u3001png \u683C\u5F0F\u7684\u56FE\u7247"),!1},k=e=>{f.success("\u4E0A\u4F20\u6210\u529F"),o.Form.img_url=e.data.src||"",o.Form.img=e.data.id||""},y=e=>{f.error("\u4E0A\u4F20\u5931\u8D25")},C=e=>{n.value.clearFiles(),o.Form.img="",o.Form.img_url="",o.Form.fileList=[]},d=e=>{f.success("\u4E0A\u4F20\u6210\u529F"),o.Form.attachmentFileList.push({name:e.data.src,url:e.data.src}),o.Form.attachment?o.Form.attachment=o.Form.attachment+","+e.data.id:o.Form.attachment=e.data.id},j=e=>{a.value.clearFiles(),o.Form.attachment="",o.Form.attachmentFileList=[]};return S(x({},J(o)),{editorRef:u,mode:"default",toolbarConfig:_,editorConfig:F,handleCreated:b,uploadRef:n,attachmentRef:a,Ref:t,submitAdd:g,uploadImgServer:le,handleBeforeUpload:v,handleUrlSuccess:k,handleUrlError:y,handleRemove:C,handleAttachmentSuccess:d,handleAttachmentRemove:j})}},ie={style:{border:"1px solid #ccc","z-index":"100"}},de=w("\u5DF2\u5BA1\u6838"),me=w("\u5F85\u5BA1\u6838");function ce(a,t,n,s,R,p){const o=c("el-input"),u=c("el-form-item"),_=c("Toolbar"),F=c("Editor"),b=c("el-date-picker"),g=c("el-radio"),v=c("el-radio-group"),k=c("el-button"),y=c("el-form"),C=c("el-card");return Q(),W(C,{style:{"min-height":"100%"}},{default:i(()=>[r(y,{model:a.Form,rules:a.rules,ref:"Ref","label-width":"100px"},{default:i(()=>[r(u,{label:"\u6807\u9898",prop:"title"},{default:i(()=>[r(o,{modelValue:a.Form.title,"onUpdate:modelValue":t[0]||(t[0]=d=>a.Form.title=d),placeholder:"\u8BF7\u8F93\u5165\u6807\u9898",type:"text"},null,8,["modelValue"])]),_:1}),r(u,{label:"\u5185\u5BB9",prop:"content"},{default:i(()=>[X("div",ie,[r(_,{style:{"border-bottom":"1px solid #ccc"},editor:s.editorRef,defaultConfig:s.toolbarConfig,mode:s.mode},null,8,["editor","defaultConfig","mode"]),r(F,{style:{height:"500px","overflow-y":"hidden"},modelValue:a.Form.content,"onUpdate:modelValue":t[1]||(t[1]=d=>a.Form.content=d),defaultConfig:s.editorConfig,mode:s.mode,onOnCreated:s.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),r(u,{label:"\u53D1\u5E03\u65F6\u95F4",prop:"release_time"},{default:i(()=>[r(b,{modelValue:a.Form.release_time,"onUpdate:modelValue":t[2]||(t[2]=d=>a.Form.release_time=d),type:"datetime",placeholder:"\u8BF7\u8F93\u5165\u53D1\u5E03\u65F6\u95F4"},null,8,["modelValue"])]),_:1}),r(u,{label:"\u72B6\u6001",prop:"status"},{default:i(()=>[r(v,{modelValue:a.Form.status,"onUpdate:modelValue":t[3]||(t[3]=d=>a.Form.status=d),disabled:""},{default:i(()=>[r(g,{label:"1"},{default:i(()=>[de]),_:1}),r(g,{label:"0"},{default:i(()=>[me]),_:1})]),_:1},8,["modelValue"])]),_:1}),r(u,null,{default:i(()=>[r(k,{type:"primary",onClick:t[4]||(t[4]=d=>s.submitAdd())},{default:i(()=>[w(Y(a.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})}var he=ae(se,[["render",ce]]);export{he as default};
