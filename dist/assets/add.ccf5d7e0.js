var E=Object.defineProperty,F=Object.defineProperties;var N=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var k=(o,t,r)=>t in o?E(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,C=(o,t)=>{for(var r in t||(t={}))T.call(t,r)&&k(o,r,t[r]);if(v)for(var r of v(t))A.call(t,r)&&k(o,r,t[r]);return o},w=(o,t)=>F(o,N(t));import{a as x,B as R,E as z,T as B}from"./index.esm.77a649e9.js";import{_ as V,a as I,c as g}from"./index.19785c67.js";import{am as M,aq as O,u as S,r as $,au as j,E as m,o as H,b as _,av as q,t as K,d as i,e as U,n as D,w as c,j as d,g as G,k as J,i as L}from"./vendor.573e8a1f.js";function P(o,t){const{link:r="",fileName:n=""}=o;return`<a data-w-e-type="attachment" data-w-e-is-void data-w-e-is-inline data-link="${r}" data-fileName="${n}" href="${r}" target="_blank">${n}</a>`}const Q={type:"attachment",elemToHtml:P};x.elemsToHtml=[Q];R.registerModule(x);const W={name:"history_add",components:{Editor:z,Toolbar:B},setup(){const o=M(null),t=O(),r=S(),{id:n}=t.query,l=$({token:"Bearer "+I("token")||"",id:n,historyForm:{content:""},rules:{content:[{required:!1,message:"\u5185\u5BB9\u5FC5\u987B",trigger:["change"]}]}}),u=j(),h={insertKeys:{index:31,keys:["uploadAttachment"]}},p={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",hoverbarKeys:{attachment:{menuKeys:["downloadAttachment"]}},MENU_CONF:{uploadImage:{server:g,fieldName:"file",maxFileSize:2*1024*1024,maxNumberOfFiles:10,allowedFileTypes:["image/*"],meta:{basket:"img"},headers:{Authorization:l.token},customInsert:function(e,a){a(e.data.src,e.data.file_name,e.data.src)},onError(e,a,s){m.error(new Error(a).message),console.log(e,a,s)}},uploadVideo:{server:g,fieldName:"file",maxFileSize:100*1024*1024,allowedFileTypes:["video/*"],meta:{basket:"video"},headers:{Authorization:l.token},customInsert:function(e,a){a(e.data.src)},onError(e,a,s){m.error(new Error(a).message),console.log(e,a,s)}},uploadAttachment:{server:g,fieldName:"file",maxFileSize:10*1024*1024,meta:{basket:"attachment"},headers:{Authorization:l.token},customInsert:function(e,a,s){s(`${a.name}`,e.data.src)},onError(e,a,s){m.error(new Error(a).message),console.log(e,a,s)}}}},f=e=>{u.value=e};H(()=>{n&&_.get(`/api/back/historys/${n}`).then(e=>{l.historyForm={content:e.data.content}})}),q(()=>{const e=u.value;e!=null&&e.destroy()});const y=()=>{o.value.validate(e=>{if(e){let a=_.post,s={content:l.historyForm.content},b="/api/back/historys";n&&(a=_.put,b=`/api/back/historys/${n}`),a(b,s).then(()=>{n?m.success("\u4FEE\u6539\u6210\u529F"):m.success("\u6DFB\u52A0\u6210\u529F"),r.push({path:"/history"})})}})};return w(C({},K(l)),{editorRef:u,mode:"default",toolbarConfig:h,editorConfig:p,handleCreated:f,historyRef:o,submitAdd:y})}},X={style:{border:"1px solid #ccc","z-index":"100"}};function Y(o,t,r,n,l,u){const h=i("Toolbar"),p=i("Editor"),f=i("el-form-item"),y=i("el-button"),e=i("el-form"),a=i("el-card");return U(),D(a,{style:{"min-height":"100%"}},{default:c(()=>[d(e,{model:o.historyForm,rules:o.rules,ref:"historyRef","label-width":"100px",style:{"margin-top":"30px"}},{default:c(()=>[d(f,{label:"\u5185\u5BB9",prop:"content"},{default:c(()=>[G("div",X,[d(h,{style:{"border-bottom":"1px solid #ccc"},editor:n.editorRef,defaultConfig:n.toolbarConfig,mode:n.mode},null,8,["editor","defaultConfig","mode"]),d(p,{style:{height:"500px","overflow-y":"hidden"},modelValue:o.historyForm.content,"onUpdate:modelValue":t[0]||(t[0]=s=>o.historyForm.content=s),defaultConfig:n.editorConfig,mode:n.mode,onOnCreated:n.handleCreated},null,8,["modelValue","defaultConfig","mode","onOnCreated"])])]),_:1}),d(f,null,{default:c(()=>[d(y,{type:"primary",onClick:t[1]||(t[1]=s=>n.submitAdd())},{default:c(()=>[J(L(o.id?"\u7ACB\u5373\u4FEE\u6539":"\u7ACB\u5373\u521B\u5EFA"),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})}var ae=V(W,[["render",Y]]);export{ae as default};
